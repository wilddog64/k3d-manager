#!/usr/bin/env bash
# Certificate rotation testing environment variables
#
# Usage:
#   source scripts/etc/jenkins/cert-rotation-test.env
#   ./scripts/k3d-manager deploy_jenkins --enable-vault
#
# This configuration creates short-lived certificates and frequent rotation
# checks to validate the automatic certificate rotation functionality.
#
# WARNING: These settings are for TESTING ONLY. Do not use in production.

# Certificate lifetime: 10 minutes (default: 720h/30 days)
# Certificates will expire 10 minutes after issuance
export VAULT_PKI_ROLE_TTL="10m"

# Renew threshold: 300 seconds (5 minutes before expiry)
# When a certificate has 5 minutes or less remaining, trigger rotation
export JENKINS_CERT_ROTATOR_RENEW_BEFORE="300"

# CronJob schedule: every 2 minutes
# Check for certificate expiration every 2 minutes
export JENKINS_CERT_ROTATOR_SCHEDULE="*/2 * * * *"

# Enable certificate rotation
export JENKINS_CERT_ROTATOR_ENABLED="1"

# Optional: Uncomment to test with even shorter intervals
# export VAULT_PKI_ROLE_TTL="5m"                     # 5-min cert lifetime
# export JENKINS_CERT_ROTATOR_RENEW_BEFORE="120"    # Renew at 2 min remaining
# export JENKINS_CERT_ROTATOR_SCHEDULE="*/1 * * * *" # Check every minute

echo "Certificate rotation test environment loaded:"
echo "  Certificate TTL: ${VAULT_PKI_ROLE_TTL}"
echo "  Renewal threshold: ${JENKINS_CERT_ROTATOR_RENEW_BEFORE}s"
echo "  CronJob schedule: ${JENKINS_CERT_ROTATOR_SCHEDULE}"
