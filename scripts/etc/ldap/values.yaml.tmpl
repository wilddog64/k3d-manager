# --- OpenLDAP chart defaults (johanneskastl-openldap-bitnami) ---

replicaCount: 1

image:
  repository: "${LDAP_IMAGE_REPOSITORY}"
  pullPolicy: "${LDAP_IMAGE_PULL_POLICY}"
  tag: "${LDAP_IMAGE_TAG}"

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

# Populated by ESO -> Secret (Vault-sourced credentials)
envFrom:
  - secretRef:
      name: "${LDAP_ADMIN_SECRET_NAME}"
extraEnv:
  - name: LDAP_ROOT
    value: "${LDAP_ROOT}"
  - name: LDAP_DOMAIN
    value: "${LDAP_DOMAIN}"
  - name: LDAP_BASE_DN
    value: "${LDAP_BASE_DN}"
  - name: LDAP_ORG_NAME
    value: "${LDAP_ORG_NAME}"
  - name: LDAP_ADMIN_USERNAME
    value: "${LDAP_ADMIN_USERNAME}"

# Skip Bitnami's sample tree only when a custom LDIF secret is mounted
skip_default_tree_generation: ${LDAP_SKIP_DEFAULT_TREE}

mount_ldif_secret:
  enabled: ${LDAP_LDIF_ENABLED}
  secretName: "${LDAP_LDIF_SECRET_NAME}"

tls_enabled: true

tls_certificates_from_secret:
  enabled: false

serviceAccount:
  create: true
  annotations: {}
  name: ""

service:
  type: "ClusterIP"
  ports:
    ldap-tcp:
      enabled: true
      port: ${LDAP_PORT}
      protocol: TCP
      targetPort: 1389
    ldap-udp:
      enabled: false
      port: ${LDAP_PORT}
      protocol: UDP
      targetPort: 1389
    ldaps-tcp:
      enabled: true
      port: ${LDAP_TLS}
      protocol: TCP
      targetPort: 1636
    ldaps-udp:
      enabled: false
      port: ${LDAP_TLS}
      protocol: UDP
      targetPort: 1636

ingress:
  enabled: false
  className: ""
  annotations: {}
  hosts:
    - host: "chart-example.local"
      paths:
        - path: /
          pathType: ImplementationSpecific
  tls: []

podAnnotations:
  sidecar.istio.io/inject: "false"

podSecurityContext:
  fsGroup: 1001

securityContext:
  capabilities:
    drop:
      - ALL
    add:
      - NET_BIND_SERVICE
  readOnlyRootFilesystem: false
  runAsNonRoot: true
  runAsUser: 1001

resources:
  requests:
    cpu: "${LDAP_REQ_CPU}"
    memory: "${LDAP_REQ_MEM}"
  limits:
    memory: "${LDAP_LIMIT_MEM}"

nodeSelector: {}

tolerations: []

affinity: {}
